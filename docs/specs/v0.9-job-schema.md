# v0.9 — Job Schema (Draft)

**Goal:** Provide a stable, explicit-units data contract for running the beam engine in batch/automation workflows.

This schema is intentionally minimal:
- Single beam per job
- Multiple load cases/combos per job
- Output is deterministic JSON + CSV

Future versions can add:
- multiple beams per job
- ETABS parsed raw tables
- ACI/other codes (additional `code` values)

---

## 1) Design Principles

- Deterministic: same inputs → same outputs.
- Explicit units at the boundary: no hidden defaults.
- Engine-first: the job file contains only data; no worksheet concepts.
- Forward-compatible: include `schema_version`.

---

## 2) Input File: `job.json`

### 2.1 Top-level fields

```json
{
  "schema_version": 1,
  "job_id": "job_2025-12-19_001",
  "code": "IS456",
  "units": "IS456",
  "beam": {
    "b_mm": 300.0,
    "D_mm": 500.0,
    "d_mm": 450.0,
    "d_dash_mm": 50.0,
    "fck_nmm2": 25.0,
    "fy_nmm2": 500.0,
    "asv_mm2": 100.0,
    "pt_percent": null
  },
  "cases": [
    {"case_id": "C1", "mu_knm": 80.0, "vu_kn": 60.0},
    {"case_id": "C2", "mu_knm": 120.0, "vu_kn": 200.0}
  ]
}
```

### 2.2 Field meanings (v1)

- `schema_version` (int, required): version of this schema.
- `job_id` (str, required): caller-provided identifier (used in outputs).
- `code` (str, required): design code identifier. v1 supports only `"IS456"`.
- `units` (str, required): units declaration for the job. v1 expects `"IS456"`.

`beam` (object, required):
- `b_mm`, `D_mm`, `d_mm`, `d_dash_mm`: mm
- `fck_nmm2`, `fy_nmm2`: N/mm²
- `asv_mm2`: mm²
- `pt_percent`: % (nullable). If null, the engine computes pt deterministically and records an assumption.

`cases` (array of objects, required):
- `case_id` (str): optional; if missing, engine assigns `CASE_1`, `CASE_2`, ... deterministically.
- `mu_knm` (float, required): factored Mu in kN·m
- `vu_kn` (float, required): factored Vu in kN

Optional per-case fields (reserved, supported by the engine):
- `deflection_params` (object): parameters for deflection check
- `crack_width_params` (object): parameters for crack-width check
- `ast_mm2_for_shear` (float): override Ast used to compute pt for shear table lookup

---

## 3) Output Folder Layout (v1)

Given an output directory chosen by the caller:

```
<out>/
  inputs/
    job.json
  parsed/
    beam.json
    cases.json
  design/
    design_results.json
    compliance_summary.csv
  deliverables/
  logs/
```

Notes:
- `design/design_results.json` is the canonical machine-readable output (JSON).
- `design/compliance_summary.csv` is a compact, Excel-friendly summary.

---

## 4) CLI (v1)

Run:

- `python -m structural_lib.job_cli run --job job.json --out ./output/job_001`

---

## 5) ACI Future-Proofing

When ACI is added later:
- Add `code: "ACI318"` (or similar)
- Add `units: "ACI"` (or an explicit units string)
- Keep the same `cases[]` structure
- The runner selects the correct engine entrypoint based on `code`
