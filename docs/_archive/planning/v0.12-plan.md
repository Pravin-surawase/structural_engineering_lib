# v0.12 Plan (Library API Expansion + DXF/BBS Quality)

**Status:** Planned
**Target version:** v0.12.0
**Theme:** Library-first APIs + DXF/BBS quality gates

---

## Goals
- Make the library easier to embed with stable, composable APIs.
- Add validation and detailing helpers that do not change core math.
- Provide repeatable DXF/BBS quality checks and optional render workflow.
- Ship with clean docs, logs, and release hygiene.

---

## Scope (v0.12)
**In scope**
- Stable API wrappers (library-first):
  - `validate_job_spec`, `validate_design_results`
  - `compute_detailing`, `compute_bbs`, `export_bbs`
  - `compute_dxf`, `compute_report`, `compute_critical`
- New CLI helpers (thin wrappers):
  - `validate` subcommand
  - `detail` subcommand
- DXF/BBS quality additions:
  - Mark-diff consistency check (CLI + API)
  - DXF content tests (layers + required text)
  - Title-block polish (sizes/cover/span)
  - DXF render workflow (PNG/PDF via script + optional dependency)
- Colab notebook updates for new workflows
- Documentation and release hygiene for v0.12

**Out of scope**
- New analysis/solver engine
- Multi-code plugins or new design codes
- UI/UX product work (this remains a library)
- Breaking schema changes (job/results/schedule/dxf contracts stay stable)

---

## Workstreams

### WS1 — API Contract + Docs (Bundle A)
- Define stable API signatures for v0.12.
- Update `docs/reference/api.md` + `docs/reference/api-stability.md`.
- Add recipes in a cookbook or reference section.

**Deliverables**
- Stable API list (frozen for v0.12+)
- Updated docs with examples

### WS2 — Validation APIs + CLI (Bundle B)
- Implement `validate_job_spec` and `validate_design_results`.
- Add `validate` CLI subcommand.
- Tests for validation paths.

**Deliverables**
- Validation API + CLI
- Unit tests + CLI smoke tests

### WS3 — Detailing + Output APIs (Bundle C)
- Implement `compute_detailing`, `compute_bbs`, `export_bbs`.
- Add `detail` CLI subcommand (outputs detailing JSON).
- Tests for deterministic outputs.

**Deliverables**
- Detailing/BBS wrappers + CLI
- Tests for JSON/CSV outputs

### WS4 — DXF + Report Wrappers (Bundle D)
- Implement `compute_dxf`, `compute_report`, `compute_critical`.
- Ensure CLI uses wrappers (no behavior change).

**Deliverables**
- Wrapper APIs with consistent signatures
- CLI paths aligned to wrappers

### WS5 — DXF/BBS Quality (Bundle E, already delivered)
- Mark-diff consistency check (API + CLI)
- DXF content tests
- Title block polish
- Render workflow for DXF -> PNG/PDF
- Colab notebook updated

**Deliverables**
- Consistency checks + tests
- Render script guidance
- Colab notebook workflow

### WS6 — Release Hygiene
- Update CHANGELOG, RELEASES, SESSION_LOG, next-session-brief.
- Version bump only at release time.
- Update docs/README if CLI surface changes.

---

## Milestones

**M1 — API contract + validation**
Done when:
- API list frozen
- `validate` CLI works
- Tests for validation pass

**M2 — Detailing + output wrappers**
Done when:
- `detail` CLI outputs stable JSON
- BBS/DXF/report wrappers available
- Tests updated

**M3 — Release prep**
Done when:
- CHANGELOG + RELEASES entries prepared
- Version bump committed
- Pre-release checklist updated
- CI green

---

## Definition of Done (v0.12)
- Library-first APIs documented and tested.
- `validate` and `detail` CLI commands ship.
- DXF/BBS quality checks available and documented.
- Colab notebook demonstrates new workflows.
- Release notes and logs updated for v0.12.

---

## Release Workflow (v0.12)

**Pre-release checks**
```bash
cd Python
../.venv/bin/python -m pytest -q
../scripts/ci_local.sh
```

**Release steps**
1) Bump version in:
   - `Python/pyproject.toml`
   - `Python/structural_lib/api.py`
   - `VBA/Modules/M08_API.bas`
2) Update:
   - `CHANGELOG.md`
   - `docs/RELEASES.md`
   - `docs/SESSION_LOG.md`
   - `docs/planning/next-session-brief.md`
3) Tag + push release:
```bash
git tag -a v0.12.0 -m "v0.12.0"
git push origin v0.12.0
```

---

## References
- `docs/planning/library-api-expansion.md`
- `docs/planning/bbs-dxf-improvement-plan.md`
- `docs/TASKS.md`
